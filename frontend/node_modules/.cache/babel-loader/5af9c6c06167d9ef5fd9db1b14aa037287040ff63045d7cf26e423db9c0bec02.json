{"ast":null,"code":"/**\n * @license\n * Copyright 2017 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { existsSync } from 'node:fs';\nimport { tmpdir } from 'node:os';\nimport { join } from 'node:path';\nimport { Browser as InstalledBrowser, CDP_WEBSOCKET_ENDPOINT_REGEX, launch, TimeoutError as BrowsersTimeoutError, WEBDRIVER_BIDI_WEBSOCKET_ENDPOINT_REGEX, computeExecutablePath } from '@puppeteer/browsers';\nimport { firstValueFrom, from, map, race, timer } from '../../third_party/rxjs/rxjs.js';\nimport { CdpBrowser } from '../cdp/Browser.js';\nimport { Connection } from '../cdp/Connection.js';\nimport { TimeoutError } from '../common/Errors.js';\nimport { debugError, DEFAULT_VIEWPORT } from '../common/util.js';\nimport { NodeWebSocketTransport as WebSocketTransport } from './NodeWebSocketTransport.js';\nimport { PipeTransport } from './PipeTransport.js';\n/**\n * Describes a launcher - a class that is able to create and launch a browser instance.\n *\n * @public\n */\nexport class BrowserLauncher {\n  #browser;\n  /**\n   * @internal\n   */\n  puppeteer;\n  /**\n   * @internal\n   */\n  constructor(puppeteer, browser) {\n    this.puppeteer = puppeteer;\n    this.#browser = browser;\n  }\n  get browser() {\n    return this.#browser;\n  }\n  async launch(options = {}) {\n    const {\n      dumpio = false,\n      enableExtensions = false,\n      env = process.env,\n      handleSIGINT = true,\n      handleSIGTERM = true,\n      handleSIGHUP = true,\n      acceptInsecureCerts = false,\n      networkEnabled = true,\n      defaultViewport = DEFAULT_VIEWPORT,\n      downloadBehavior,\n      slowMo = 0,\n      timeout = 30000,\n      waitForInitialPage = true,\n      protocolTimeout\n    } = options;\n    let {\n      protocol\n    } = options;\n    // Default to 'webDriverBiDi' for Firefox.\n    if (this.#browser === 'firefox' && protocol === undefined) {\n      protocol = 'webDriverBiDi';\n    }\n    if (this.#browser === 'firefox' && protocol === 'cdp') {\n      throw new Error('Connecting to Firefox using CDP is no longer supported');\n    }\n    const launchArgs = await this.computeLaunchArguments({\n      ...options,\n      protocol\n    });\n    if (!existsSync(launchArgs.executablePath)) {\n      throw new Error(`Browser was not found at the configured executablePath (${launchArgs.executablePath})`);\n    }\n    const usePipe = launchArgs.args.includes('--remote-debugging-pipe');\n    const onProcessExit = async () => {\n      await this.cleanUserDataDir(launchArgs.userDataDir, {\n        isTemp: launchArgs.isTempUserDataDir\n      });\n    };\n    if (this.#browser === 'firefox' && protocol === 'webDriverBiDi' && usePipe) {\n      throw new Error('Pipe connections are not supported with Firefox and WebDriver BiDi');\n    }\n    const browserProcess = launch({\n      executablePath: launchArgs.executablePath,\n      args: launchArgs.args,\n      handleSIGHUP,\n      handleSIGTERM,\n      handleSIGINT,\n      dumpio,\n      env,\n      pipe: usePipe,\n      onExit: onProcessExit\n    });\n    let browser;\n    let cdpConnection;\n    let closing = false;\n    const browserCloseCallback = async () => {\n      if (closing) {\n        return;\n      }\n      closing = true;\n      await this.closeBrowser(browserProcess, cdpConnection);\n    };\n    try {\n      if (this.#browser === 'firefox' && protocol === 'webDriverBiDi') {\n        browser = await this.createBiDiBrowser(browserProcess, browserCloseCallback, {\n          timeout,\n          protocolTimeout,\n          slowMo,\n          defaultViewport,\n          acceptInsecureCerts,\n          networkEnabled\n        });\n      } else {\n        if (usePipe) {\n          cdpConnection = await this.createCdpPipeConnection(browserProcess, {\n            timeout,\n            protocolTimeout,\n            slowMo\n          });\n        } else {\n          cdpConnection = await this.createCdpSocketConnection(browserProcess, {\n            timeout,\n            protocolTimeout,\n            slowMo\n          });\n        }\n        if (protocol === 'webDriverBiDi') {\n          browser = await this.createBiDiOverCdpBrowser(browserProcess, cdpConnection, browserCloseCallback, {\n            defaultViewport,\n            acceptInsecureCerts,\n            networkEnabled\n          });\n        } else {\n          browser = await CdpBrowser._create(cdpConnection, [], acceptInsecureCerts, defaultViewport, downloadBehavior, browserProcess.nodeProcess, browserCloseCallback, options.targetFilter, undefined, undefined, networkEnabled);\n        }\n      }\n    } catch (error) {\n      void browserCloseCallback();\n      if (error instanceof BrowsersTimeoutError) {\n        throw new TimeoutError(error.message);\n      }\n      throw error;\n    }\n    if (Array.isArray(enableExtensions)) {\n      if (this.#browser === 'chrome' && !usePipe) {\n        throw new Error('To use `enableExtensions` with a list of paths in Chrome, you must be connected with `--remote-debugging-pipe` (`pipe: true`).');\n      }\n      await Promise.all([enableExtensions.map(path => {\n        return browser.installExtension(path);\n      })]);\n    }\n    if (waitForInitialPage) {\n      await this.waitForPageTarget(browser, timeout);\n    }\n    return browser;\n  }\n  /**\n   * @internal\n   */\n  async closeBrowser(browserProcess, cdpConnection) {\n    if (cdpConnection) {\n      // Attempt to close the browser gracefully\n      try {\n        await cdpConnection.closeBrowser();\n        await browserProcess.hasClosed();\n      } catch (error) {\n        debugError(error);\n        await browserProcess.close();\n      }\n    } else {\n      // Wait for a possible graceful shutdown.\n      await firstValueFrom(race(from(browserProcess.hasClosed()), timer(5000).pipe(map(() => {\n        return from(browserProcess.close());\n      }))));\n    }\n  }\n  /**\n   * @internal\n   */\n  async waitForPageTarget(browser, timeout) {\n    try {\n      await browser.waitForTarget(t => {\n        return t.type() === 'page';\n      }, {\n        timeout\n      });\n    } catch (error) {\n      await browser.close();\n      throw error;\n    }\n  }\n  /**\n   * @internal\n   */\n  async createCdpSocketConnection(browserProcess, opts) {\n    const browserWSEndpoint = await browserProcess.waitForLineOutput(CDP_WEBSOCKET_ENDPOINT_REGEX, opts.timeout);\n    const transport = await WebSocketTransport.create(browserWSEndpoint);\n    return new Connection(browserWSEndpoint, transport, opts.slowMo, opts.protocolTimeout);\n  }\n  /**\n   * @internal\n   */\n  async createCdpPipeConnection(browserProcess, opts) {\n    // stdio was assigned during start(), and the 'pipe' option there adds the\n    // 4th and 5th items to stdio array\n    const {\n      3: pipeWrite,\n      4: pipeRead\n    } = browserProcess.nodeProcess.stdio;\n    const transport = new PipeTransport(pipeWrite, pipeRead);\n    return new Connection('', transport, opts.slowMo, opts.protocolTimeout);\n  }\n  /**\n   * @internal\n   */\n  async createBiDiOverCdpBrowser(browserProcess, connection, closeCallback, opts) {\n    const BiDi = await import(/* webpackIgnore: true */'../bidi/bidi.js');\n    const bidiConnection = await BiDi.connectBidiOverCdp(connection);\n    return await BiDi.BidiBrowser.create({\n      connection: bidiConnection,\n      cdpConnection: connection,\n      closeCallback,\n      process: browserProcess.nodeProcess,\n      defaultViewport: opts.defaultViewport,\n      acceptInsecureCerts: opts.acceptInsecureCerts,\n      networkEnabled: opts.networkEnabled\n    });\n  }\n  /**\n   * @internal\n   */\n  async createBiDiBrowser(browserProcess, closeCallback, opts) {\n    const browserWSEndpoint = (await browserProcess.waitForLineOutput(WEBDRIVER_BIDI_WEBSOCKET_ENDPOINT_REGEX, opts.timeout)) + '/session';\n    const transport = await WebSocketTransport.create(browserWSEndpoint);\n    const BiDi = await import(/* webpackIgnore: true */'../bidi/bidi.js');\n    const bidiConnection = new BiDi.BidiConnection(browserWSEndpoint, transport, opts.slowMo, opts.protocolTimeout);\n    return await BiDi.BidiBrowser.create({\n      connection: bidiConnection,\n      closeCallback,\n      process: browserProcess.nodeProcess,\n      defaultViewport: opts.defaultViewport,\n      acceptInsecureCerts: opts.acceptInsecureCerts,\n      networkEnabled: opts.networkEnabled ?? true\n    });\n  }\n  /**\n   * @internal\n   */\n  getProfilePath() {\n    return join(this.puppeteer.configuration.temporaryDirectory ?? tmpdir(), `puppeteer_dev_${this.browser}_profile-`);\n  }\n  /**\n   * @internal\n   */\n  resolveExecutablePath(headless, validatePath = true) {\n    let executablePath = this.puppeteer.configuration.executablePath;\n    if (executablePath) {\n      if (validatePath && !existsSync(executablePath)) {\n        throw new Error(`Tried to find the browser at the configured path (${executablePath}), but no executable was found.`);\n      }\n      return executablePath;\n    }\n    function puppeteerBrowserToInstalledBrowser(browser, headless) {\n      switch (browser) {\n        case 'chrome':\n          if (headless === 'shell') {\n            return InstalledBrowser.CHROMEHEADLESSSHELL;\n          }\n          return InstalledBrowser.CHROME;\n        case 'firefox':\n          return InstalledBrowser.FIREFOX;\n      }\n      return InstalledBrowser.CHROME;\n    }\n    const browserType = puppeteerBrowserToInstalledBrowser(this.browser, headless);\n    executablePath = computeExecutablePath({\n      cacheDir: this.puppeteer.defaultDownloadPath,\n      browser: browserType,\n      buildId: this.puppeteer.browserVersion\n    });\n    if (validatePath && !existsSync(executablePath)) {\n      const configVersion = this.puppeteer.configuration?.[this.browser]?.version;\n      if (configVersion) {\n        throw new Error(`Tried to find the browser at the configured path (${executablePath}) for version ${configVersion}, but no executable was found.`);\n      }\n      switch (this.browser) {\n        case 'chrome':\n          throw new Error(`Could not find Chrome (ver. ${this.puppeteer.browserVersion}). This can occur if either\\n` + ` 1. you did not perform an installation before running the script (e.g. \\`npx puppeteer browsers install ${browserType}\\`) or\\n` + ` 2. your cache path is incorrectly configured (which is: ${this.puppeteer.configuration.cacheDirectory}).\\n` + 'For (2), check out our guide on configuring puppeteer at https://pptr.dev/guides/configuration.');\n        case 'firefox':\n          throw new Error(`Could not find Firefox (rev. ${this.puppeteer.browserVersion}). This can occur if either\\n` + ' 1. you did not perform an installation for Firefox before running the script (e.g. `npx puppeteer browsers install firefox`) or\\n' + ` 2. your cache path is incorrectly configured (which is: ${this.puppeteer.configuration.cacheDirectory}).\\n` + 'For (2), check out our guide on configuring puppeteer at https://pptr.dev/guides/configuration.');\n      }\n    }\n    return executablePath;\n  }\n}","map":{"version":3,"names":["existsSync","tmpdir","join","Browser","InstalledBrowser","CDP_WEBSOCKET_ENDPOINT_REGEX","launch","TimeoutError","BrowsersTimeoutError","WEBDRIVER_BIDI_WEBSOCKET_ENDPOINT_REGEX","computeExecutablePath","firstValueFrom","from","map","race","timer","CdpBrowser","Connection","debugError","DEFAULT_VIEWPORT","NodeWebSocketTransport","WebSocketTransport","PipeTransport","BrowserLauncher","browser","puppeteer","constructor","options","dumpio","enableExtensions","env","process","handleSIGINT","handleSIGTERM","handleSIGHUP","acceptInsecureCerts","networkEnabled","defaultViewport","downloadBehavior","slowMo","timeout","waitForInitialPage","protocolTimeout","protocol","undefined","Error","launchArgs","computeLaunchArguments","executablePath","usePipe","args","includes","onProcessExit","cleanUserDataDir","userDataDir","isTemp","isTempUserDataDir","browserProcess","pipe","onExit","cdpConnection","closing","browserCloseCallback","closeBrowser","createBiDiBrowser","createCdpPipeConnection","createCdpSocketConnection","createBiDiOverCdpBrowser","_create","nodeProcess","targetFilter","error","message","Array","isArray","Promise","all","path","installExtension","waitForPageTarget","hasClosed","close","waitForTarget","t","type","opts","browserWSEndpoint","waitForLineOutput","transport","create","pipeWrite","pipeRead","stdio","connection","closeCallback","BiDi","bidiConnection","connectBidiOverCdp","BidiBrowser","BidiConnection","getProfilePath","configuration","temporaryDirectory","resolveExecutablePath","headless","validatePath","puppeteerBrowserToInstalledBrowser","CHROMEHEADLESSSHELL","CHROME","FIREFOX","browserType","cacheDir","defaultDownloadPath","buildId","browserVersion","configVersion","version","cacheDirectory"],"sources":["/Users/goyac1/Desktop/Projects/puppeteer/node_modules/puppeteer-core/src/node/BrowserLauncher.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2017 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport {existsSync} from 'node:fs';\nimport {tmpdir} from 'node:os';\nimport {join} from 'node:path';\n\nimport {\n  Browser as InstalledBrowser,\n  CDP_WEBSOCKET_ENDPOINT_REGEX,\n  launch,\n  TimeoutError as BrowsersTimeoutError,\n  WEBDRIVER_BIDI_WEBSOCKET_ENDPOINT_REGEX,\n  computeExecutablePath,\n} from '@puppeteer/browsers';\n\nimport {\n  firstValueFrom,\n  from,\n  map,\n  race,\n  timer,\n} from '../../third_party/rxjs/rxjs.js';\nimport type {Browser, BrowserCloseCallback} from '../api/Browser.js';\nimport {CdpBrowser} from '../cdp/Browser.js';\nimport {Connection} from '../cdp/Connection.js';\nimport {TimeoutError} from '../common/Errors.js';\nimport type {SupportedBrowser} from '../common/SupportedBrowser.js';\nimport {debugError, DEFAULT_VIEWPORT} from '../common/util.js';\nimport type {Viewport} from '../common/Viewport.js';\n\nimport type {ChromeReleaseChannel, LaunchOptions} from './LaunchOptions.js';\nimport {NodeWebSocketTransport as WebSocketTransport} from './NodeWebSocketTransport.js';\nimport {PipeTransport} from './PipeTransport.js';\nimport type {PuppeteerNode} from './PuppeteerNode.js';\n\n/**\n * @internal\n */\nexport interface ResolvedLaunchArgs {\n  isTempUserDataDir: boolean;\n  userDataDir: string;\n  executablePath: string;\n  args: string[];\n}\n\n/**\n * Describes a launcher - a class that is able to create and launch a browser instance.\n *\n * @public\n */\nexport abstract class BrowserLauncher {\n  #browser: SupportedBrowser;\n\n  /**\n   * @internal\n   */\n  puppeteer: PuppeteerNode;\n\n  /**\n   * @internal\n   */\n  constructor(puppeteer: PuppeteerNode, browser: SupportedBrowser) {\n    this.puppeteer = puppeteer;\n    this.#browser = browser;\n  }\n\n  get browser(): SupportedBrowser {\n    return this.#browser;\n  }\n\n  async launch(options: LaunchOptions = {}): Promise<Browser> {\n    const {\n      dumpio = false,\n      enableExtensions = false,\n      env = process.env,\n      handleSIGINT = true,\n      handleSIGTERM = true,\n      handleSIGHUP = true,\n      acceptInsecureCerts = false,\n      networkEnabled = true,\n      defaultViewport = DEFAULT_VIEWPORT,\n      downloadBehavior,\n      slowMo = 0,\n      timeout = 30000,\n      waitForInitialPage = true,\n      protocolTimeout,\n    } = options;\n\n    let {protocol} = options;\n\n    // Default to 'webDriverBiDi' for Firefox.\n    if (this.#browser === 'firefox' && protocol === undefined) {\n      protocol = 'webDriverBiDi';\n    }\n\n    if (this.#browser === 'firefox' && protocol === 'cdp') {\n      throw new Error('Connecting to Firefox using CDP is no longer supported');\n    }\n\n    const launchArgs = await this.computeLaunchArguments({\n      ...options,\n      protocol,\n    });\n\n    if (!existsSync(launchArgs.executablePath)) {\n      throw new Error(\n        `Browser was not found at the configured executablePath (${launchArgs.executablePath})`,\n      );\n    }\n\n    const usePipe = launchArgs.args.includes('--remote-debugging-pipe');\n\n    const onProcessExit = async () => {\n      await this.cleanUserDataDir(launchArgs.userDataDir, {\n        isTemp: launchArgs.isTempUserDataDir,\n      });\n    };\n\n    if (\n      this.#browser === 'firefox' &&\n      protocol === 'webDriverBiDi' &&\n      usePipe\n    ) {\n      throw new Error(\n        'Pipe connections are not supported with Firefox and WebDriver BiDi',\n      );\n    }\n\n    const browserProcess = launch({\n      executablePath: launchArgs.executablePath,\n      args: launchArgs.args,\n      handleSIGHUP,\n      handleSIGTERM,\n      handleSIGINT,\n      dumpio,\n      env,\n      pipe: usePipe,\n      onExit: onProcessExit,\n    });\n\n    let browser: Browser;\n    let cdpConnection: Connection;\n    let closing = false;\n\n    const browserCloseCallback: BrowserCloseCallback = async () => {\n      if (closing) {\n        return;\n      }\n      closing = true;\n      await this.closeBrowser(browserProcess, cdpConnection);\n    };\n\n    try {\n      if (this.#browser === 'firefox' && protocol === 'webDriverBiDi') {\n        browser = await this.createBiDiBrowser(\n          browserProcess,\n          browserCloseCallback,\n          {\n            timeout,\n            protocolTimeout,\n            slowMo,\n            defaultViewport,\n            acceptInsecureCerts,\n            networkEnabled,\n          },\n        );\n      } else {\n        if (usePipe) {\n          cdpConnection = await this.createCdpPipeConnection(browserProcess, {\n            timeout,\n            protocolTimeout,\n            slowMo,\n          });\n        } else {\n          cdpConnection = await this.createCdpSocketConnection(browserProcess, {\n            timeout,\n            protocolTimeout,\n            slowMo,\n          });\n        }\n        if (protocol === 'webDriverBiDi') {\n          browser = await this.createBiDiOverCdpBrowser(\n            browserProcess,\n            cdpConnection,\n            browserCloseCallback,\n            {\n              defaultViewport,\n              acceptInsecureCerts,\n              networkEnabled,\n            },\n          );\n        } else {\n          browser = await CdpBrowser._create(\n            cdpConnection,\n            [],\n            acceptInsecureCerts,\n            defaultViewport,\n            downloadBehavior,\n            browserProcess.nodeProcess,\n            browserCloseCallback,\n            options.targetFilter,\n            undefined,\n            undefined,\n            networkEnabled,\n          );\n        }\n      }\n    } catch (error) {\n      void browserCloseCallback();\n      if (error instanceof BrowsersTimeoutError) {\n        throw new TimeoutError(error.message);\n      }\n      throw error;\n    }\n\n    if (Array.isArray(enableExtensions)) {\n      if (this.#browser === 'chrome' && !usePipe) {\n        throw new Error(\n          'To use `enableExtensions` with a list of paths in Chrome, you must be connected with `--remote-debugging-pipe` (`pipe: true`).',\n        );\n      }\n\n      await Promise.all([\n        enableExtensions.map(path => {\n          return browser.installExtension(path);\n        }),\n      ]);\n    }\n\n    if (waitForInitialPage) {\n      await this.waitForPageTarget(browser, timeout);\n    }\n\n    return browser;\n  }\n\n  abstract executablePath(\n    channel?: ChromeReleaseChannel,\n    validatePath?: boolean,\n  ): string;\n\n  abstract defaultArgs(object: LaunchOptions): string[];\n\n  /**\n   * @internal\n   */\n  protected abstract computeLaunchArguments(\n    options: LaunchOptions,\n  ): Promise<ResolvedLaunchArgs>;\n\n  /**\n   * @internal\n   */\n  protected abstract cleanUserDataDir(\n    path: string,\n    opts: {isTemp: boolean},\n  ): Promise<void>;\n\n  /**\n   * @internal\n   */\n  protected async closeBrowser(\n    browserProcess: ReturnType<typeof launch>,\n    cdpConnection?: Connection,\n  ): Promise<void> {\n    if (cdpConnection) {\n      // Attempt to close the browser gracefully\n      try {\n        await cdpConnection.closeBrowser();\n        await browserProcess.hasClosed();\n      } catch (error) {\n        debugError(error);\n        await browserProcess.close();\n      }\n    } else {\n      // Wait for a possible graceful shutdown.\n      await firstValueFrom(\n        race(\n          from(browserProcess.hasClosed()),\n          timer(5000).pipe(\n            map(() => {\n              return from(browserProcess.close());\n            }),\n          ),\n        ),\n      );\n    }\n  }\n\n  /**\n   * @internal\n   */\n  protected async waitForPageTarget(\n    browser: Browser,\n    timeout: number,\n  ): Promise<void> {\n    try {\n      await browser.waitForTarget(\n        t => {\n          return t.type() === 'page';\n        },\n        {timeout},\n      );\n    } catch (error) {\n      await browser.close();\n      throw error;\n    }\n  }\n\n  /**\n   * @internal\n   */\n  protected async createCdpSocketConnection(\n    browserProcess: ReturnType<typeof launch>,\n    opts: {\n      timeout: number;\n      protocolTimeout: number | undefined;\n      slowMo: number;\n    },\n  ): Promise<Connection> {\n    const browserWSEndpoint = await browserProcess.waitForLineOutput(\n      CDP_WEBSOCKET_ENDPOINT_REGEX,\n      opts.timeout,\n    );\n    const transport = await WebSocketTransport.create(browserWSEndpoint);\n    return new Connection(\n      browserWSEndpoint,\n      transport,\n      opts.slowMo,\n      opts.protocolTimeout,\n    );\n  }\n\n  /**\n   * @internal\n   */\n  protected async createCdpPipeConnection(\n    browserProcess: ReturnType<typeof launch>,\n    opts: {\n      timeout: number;\n      protocolTimeout: number | undefined;\n      slowMo: number;\n    },\n  ): Promise<Connection> {\n    // stdio was assigned during start(), and the 'pipe' option there adds the\n    // 4th and 5th items to stdio array\n    const {3: pipeWrite, 4: pipeRead} = browserProcess.nodeProcess.stdio;\n    const transport = new PipeTransport(\n      pipeWrite as NodeJS.WritableStream,\n      pipeRead as NodeJS.ReadableStream,\n    );\n    return new Connection('', transport, opts.slowMo, opts.protocolTimeout);\n  }\n\n  /**\n   * @internal\n   */\n  protected async createBiDiOverCdpBrowser(\n    browserProcess: ReturnType<typeof launch>,\n    connection: Connection,\n    closeCallback: BrowserCloseCallback,\n    opts: {\n      defaultViewport: Viewport | null;\n      acceptInsecureCerts?: boolean;\n      networkEnabled: boolean;\n    },\n  ): Promise<Browser> {\n    const BiDi = await import(/* webpackIgnore: true */ '../bidi/bidi.js');\n    const bidiConnection = await BiDi.connectBidiOverCdp(connection);\n    return await BiDi.BidiBrowser.create({\n      connection: bidiConnection,\n      cdpConnection: connection,\n      closeCallback,\n      process: browserProcess.nodeProcess,\n      defaultViewport: opts.defaultViewport,\n      acceptInsecureCerts: opts.acceptInsecureCerts,\n      networkEnabled: opts.networkEnabled,\n    });\n  }\n\n  /**\n   * @internal\n   */\n  protected async createBiDiBrowser(\n    browserProcess: ReturnType<typeof launch>,\n    closeCallback: BrowserCloseCallback,\n    opts: {\n      timeout: number;\n      protocolTimeout: number | undefined;\n      slowMo: number;\n      defaultViewport: Viewport | null;\n      acceptInsecureCerts?: boolean;\n      networkEnabled?: boolean;\n    },\n  ): Promise<Browser> {\n    const browserWSEndpoint =\n      (await browserProcess.waitForLineOutput(\n        WEBDRIVER_BIDI_WEBSOCKET_ENDPOINT_REGEX,\n        opts.timeout,\n      )) + '/session';\n    const transport = await WebSocketTransport.create(browserWSEndpoint);\n    const BiDi = await import(/* webpackIgnore: true */ '../bidi/bidi.js');\n    const bidiConnection = new BiDi.BidiConnection(\n      browserWSEndpoint,\n      transport,\n      opts.slowMo,\n      opts.protocolTimeout,\n    );\n    return await BiDi.BidiBrowser.create({\n      connection: bidiConnection,\n      closeCallback,\n      process: browserProcess.nodeProcess,\n      defaultViewport: opts.defaultViewport,\n      acceptInsecureCerts: opts.acceptInsecureCerts,\n      networkEnabled: opts.networkEnabled ?? true,\n    });\n  }\n\n  /**\n   * @internal\n   */\n  protected getProfilePath(): string {\n    return join(\n      this.puppeteer.configuration.temporaryDirectory ?? tmpdir(),\n      `puppeteer_dev_${this.browser}_profile-`,\n    );\n  }\n\n  /**\n   * @internal\n   */\n  resolveExecutablePath(\n    headless?: boolean | 'shell',\n    validatePath = true,\n  ): string {\n    let executablePath = this.puppeteer.configuration.executablePath;\n    if (executablePath) {\n      if (validatePath && !existsSync(executablePath)) {\n        throw new Error(\n          `Tried to find the browser at the configured path (${executablePath}), but no executable was found.`,\n        );\n      }\n      return executablePath;\n    }\n\n    function puppeteerBrowserToInstalledBrowser(\n      browser?: SupportedBrowser,\n      headless?: boolean | 'shell',\n    ) {\n      switch (browser) {\n        case 'chrome':\n          if (headless === 'shell') {\n            return InstalledBrowser.CHROMEHEADLESSSHELL;\n          }\n          return InstalledBrowser.CHROME;\n        case 'firefox':\n          return InstalledBrowser.FIREFOX;\n      }\n      return InstalledBrowser.CHROME;\n    }\n\n    const browserType = puppeteerBrowserToInstalledBrowser(\n      this.browser,\n      headless,\n    );\n\n    executablePath = computeExecutablePath({\n      cacheDir: this.puppeteer.defaultDownloadPath!,\n      browser: browserType,\n      buildId: this.puppeteer.browserVersion,\n    });\n\n    if (validatePath && !existsSync(executablePath)) {\n      const configVersion =\n        this.puppeteer.configuration?.[this.browser]?.version;\n      if (configVersion) {\n        throw new Error(\n          `Tried to find the browser at the configured path (${executablePath}) for version ${configVersion}, but no executable was found.`,\n        );\n      }\n      switch (this.browser) {\n        case 'chrome':\n          throw new Error(\n            `Could not find Chrome (ver. ${this.puppeteer.browserVersion}). This can occur if either\\n` +\n              ` 1. you did not perform an installation before running the script (e.g. \\`npx puppeteer browsers install ${browserType}\\`) or\\n` +\n              ` 2. your cache path is incorrectly configured (which is: ${this.puppeteer.configuration.cacheDirectory}).\\n` +\n              'For (2), check out our guide on configuring puppeteer at https://pptr.dev/guides/configuration.',\n          );\n        case 'firefox':\n          throw new Error(\n            `Could not find Firefox (rev. ${this.puppeteer.browserVersion}). This can occur if either\\n` +\n              ' 1. you did not perform an installation for Firefox before running the script (e.g. `npx puppeteer browsers install firefox`) or\\n' +\n              ` 2. your cache path is incorrectly configured (which is: ${this.puppeteer.configuration.cacheDirectory}).\\n` +\n              'For (2), check out our guide on configuring puppeteer at https://pptr.dev/guides/configuration.',\n          );\n      }\n    }\n    return executablePath;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}