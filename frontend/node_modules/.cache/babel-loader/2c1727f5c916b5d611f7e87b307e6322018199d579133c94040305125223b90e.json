{"ast":null,"code":"/**\n * @license\n * Copyright 2017 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport assert from 'node:assert';\nimport { spawnSync } from 'node:child_process';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { mkdir, unlink } from 'node:fs/promises';\nimport os from 'node:os';\nimport path from 'node:path';\nimport ProgressBarClass from 'progress';\nimport { Browser, BrowserPlatform, downloadUrls } from './browser-data/browser-data.js';\nimport { Cache, InstalledBrowser } from './Cache.js';\nimport { debug } from './debug.js';\nimport { detectBrowserPlatform } from './detectPlatform.js';\nimport { unpackArchive } from './fileUtil.js';\nimport { downloadFile, getJSON, headHttpRequest } from './httpUtil.js';\nconst debugInstall = debug('puppeteer:browsers:install');\nconst times = new Map();\nfunction debugTime(label) {\n  times.set(label, process.hrtime());\n}\nfunction debugTimeEnd(label) {\n  const end = process.hrtime();\n  const start = times.get(label);\n  if (!start) {\n    return;\n  }\n  const duration = end[0] * 1000 + end[1] / 1e6 - (start[0] * 1000 + start[1] / 1e6); // calculate duration in milliseconds\n  debugInstall(`Duration for ${label}: ${duration}ms`);\n}\nexport async function install(options) {\n  options.platform ??= detectBrowserPlatform();\n  options.unpack ??= true;\n  if (!options.platform) {\n    throw new Error(`Cannot download a binary for the provided platform: ${os.platform()} (${os.arch()})`);\n  }\n  const url = getDownloadUrl(options.browser, options.platform, options.buildId, options.baseUrl);\n  try {\n    return await installUrl(url, options);\n  } catch (err) {\n    // If custom baseUrl is provided, do not fall back to CfT dashboard.\n    if (options.baseUrl && !options.forceFallbackForTesting) {\n      throw err;\n    }\n    debugInstall(`Error downloading from ${url}.`);\n    switch (options.browser) {\n      case Browser.CHROME:\n      case Browser.CHROMEDRIVER:\n      case Browser.CHROMEHEADLESSSHELL:\n        {\n          debugInstall(`Trying to find download URL via https://googlechromelabs.github.io/chrome-for-testing.`);\n          const version = await getJSON(new URL(`https://googlechromelabs.github.io/chrome-for-testing/${options.buildId}.json`));\n          let platform = '';\n          switch (options.platform) {\n            case BrowserPlatform.LINUX:\n              platform = 'linux64';\n              break;\n            case BrowserPlatform.MAC_ARM:\n              platform = 'mac-arm64';\n              break;\n            case BrowserPlatform.MAC:\n              platform = 'mac-x64';\n              break;\n            case BrowserPlatform.WIN32:\n              platform = 'win32';\n              break;\n            case BrowserPlatform.WIN64:\n              platform = 'win64';\n              break;\n          }\n          const backupUrl = version.downloads[options.browser]?.find(link => {\n            return link['platform'] === platform;\n          })?.url;\n          if (backupUrl) {\n            // If the URL is the same, skip the retry.\n            if (backupUrl === url.toString()) {\n              throw err;\n            }\n            debugInstall(`Falling back to downloading from ${backupUrl}.`);\n            return await installUrl(new URL(backupUrl), options);\n          }\n          throw err;\n        }\n      default:\n        throw err;\n    }\n  }\n}\nasync function installDeps(installedBrowser) {\n  if (process.platform !== 'linux' || installedBrowser.platform !== BrowserPlatform.LINUX) {\n    return;\n  }\n  // Currently, only Debian-like deps are supported.\n  const depsPath = path.join(path.dirname(installedBrowser.executablePath), 'deb.deps');\n  if (!existsSync(depsPath)) {\n    debugInstall(`deb.deps file was not found at ${depsPath}`);\n    return;\n  }\n  const data = readFileSync(depsPath, 'utf-8').split('\\n').join(',');\n  if (process.getuid?.() !== 0) {\n    throw new Error('Installing system dependencies requires root privileges');\n  }\n  let result = spawnSync('apt-get', ['-v']);\n  if (result.status !== 0) {\n    throw new Error('Failed to install system dependencies: apt-get does not seem to be available');\n  }\n  debugInstall(`Trying to install dependencies: ${data}`);\n  result = spawnSync('apt-get', ['satisfy', '-y', data, '--no-install-recommends']);\n  if (result.status !== 0) {\n    throw new Error(`Failed to install system dependencies: status=${result.status},error=${result.error},stdout=${result.stdout.toString('utf8')},stderr=${result.stderr.toString('utf8')}`);\n  }\n  debugInstall(`Installed system dependencies ${data}`);\n}\nasync function installUrl(url, options) {\n  options.platform ??= detectBrowserPlatform();\n  if (!options.platform) {\n    throw new Error(`Cannot download a binary for the provided platform: ${os.platform()} (${os.arch()})`);\n  }\n  let downloadProgressCallback = options.downloadProgressCallback;\n  if (downloadProgressCallback === 'default') {\n    downloadProgressCallback = await makeProgressCallback(options.browser, options.buildIdAlias ?? options.buildId);\n  }\n  const fileName = decodeURIComponent(url.toString()).split('/').pop();\n  assert(fileName, `A malformed download URL was found: ${url}.`);\n  const cache = new Cache(options.cacheDir);\n  const browserRoot = cache.browserRoot(options.browser);\n  const archivePath = path.join(browserRoot, `${options.buildId}-${fileName}`);\n  if (!existsSync(browserRoot)) {\n    await mkdir(browserRoot, {\n      recursive: true\n    });\n  }\n  if (!options.unpack) {\n    if (existsSync(archivePath)) {\n      return archivePath;\n    }\n    debugInstall(`Downloading binary from ${url}`);\n    debugTime('download');\n    await downloadFile(url, archivePath, downloadProgressCallback);\n    debugTimeEnd('download');\n    return archivePath;\n  }\n  const outputPath = cache.installationDir(options.browser, options.platform, options.buildId);\n  try {\n    if (existsSync(outputPath)) {\n      const installedBrowser = new InstalledBrowser(cache, options.browser, options.buildId, options.platform);\n      if (!existsSync(installedBrowser.executablePath)) {\n        throw new Error(`The browser folder (${outputPath}) exists but the executable (${installedBrowser.executablePath}) is missing`);\n      }\n      await runSetup(installedBrowser);\n      if (options.installDeps) {\n        await installDeps(installedBrowser);\n      }\n      return installedBrowser;\n    }\n    debugInstall(`Downloading binary from ${url}`);\n    try {\n      debugTime('download');\n      await downloadFile(url, archivePath, downloadProgressCallback);\n    } finally {\n      debugTimeEnd('download');\n    }\n    debugInstall(`Installing ${archivePath} to ${outputPath}`);\n    try {\n      debugTime('extract');\n      await unpackArchive(archivePath, outputPath);\n    } finally {\n      debugTimeEnd('extract');\n    }\n    const installedBrowser = new InstalledBrowser(cache, options.browser, options.buildId, options.platform);\n    if (options.buildIdAlias) {\n      const metadata = installedBrowser.readMetadata();\n      metadata.aliases[options.buildIdAlias] = options.buildId;\n      installedBrowser.writeMetadata(metadata);\n    }\n    await runSetup(installedBrowser);\n    if (options.installDeps) {\n      await installDeps(installedBrowser);\n    }\n    return installedBrowser;\n  } finally {\n    if (existsSync(archivePath)) {\n      await unlink(archivePath);\n    }\n  }\n}\nasync function runSetup(installedBrowser) {\n  // On Windows for Chrome invoke setup.exe to configure sandboxes.\n  if ((installedBrowser.platform === BrowserPlatform.WIN32 || installedBrowser.platform === BrowserPlatform.WIN64) && installedBrowser.browser === Browser.CHROME && installedBrowser.platform === detectBrowserPlatform()) {\n    try {\n      debugTime('permissions');\n      const browserDir = path.dirname(installedBrowser.executablePath);\n      const setupExePath = path.join(browserDir, 'setup.exe');\n      if (!existsSync(setupExePath)) {\n        return;\n      }\n      spawnSync(path.join(browserDir, 'setup.exe'), [`--configure-browser-in-directory=` + browserDir], {\n        shell: true\n      });\n      // TODO: Handle error here. Currently the setup.exe sometimes\n      // errors although it sets the permissions correctly.\n    } finally {\n      debugTimeEnd('permissions');\n    }\n  }\n}\n/**\n *\n * @public\n */\nexport async function uninstall(options) {\n  options.platform ??= detectBrowserPlatform();\n  if (!options.platform) {\n    throw new Error(`Cannot detect the browser platform for: ${os.platform()} (${os.arch()})`);\n  }\n  new Cache(options.cacheDir).uninstall(options.browser, options.platform, options.buildId);\n}\n/**\n * Returns metadata about browsers installed in the cache directory.\n *\n * @public\n */\nexport async function getInstalledBrowsers(options) {\n  return new Cache(options.cacheDir).getInstalledBrowsers();\n}\n/**\n * @public\n */\nexport async function canDownload(options) {\n  options.platform ??= detectBrowserPlatform();\n  if (!options.platform) {\n    throw new Error(`Cannot download a binary for the provided platform: ${os.platform()} (${os.arch()})`);\n  }\n  return await headHttpRequest(getDownloadUrl(options.browser, options.platform, options.buildId, options.baseUrl));\n}\n/**\n * Retrieves a URL for downloading the binary archive of a given browser.\n *\n * The archive is bound to the specific platform and build ID specified.\n *\n * @public\n */\nexport function getDownloadUrl(browser, platform, buildId, baseUrl) {\n  return new URL(downloadUrls[browser](platform, buildId, baseUrl));\n}\n/**\n * @public\n */\nexport function makeProgressCallback(browser, buildId) {\n  let progressBar;\n  let lastDownloadedBytes = 0;\n  return (downloadedBytes, totalBytes) => {\n    if (!progressBar) {\n      progressBar = new ProgressBarClass(`Downloading ${browser} ${buildId} - ${toMegabytes(totalBytes)} [:bar] :percent :etas `, {\n        complete: '=',\n        incomplete: ' ',\n        width: 20,\n        total: totalBytes\n      });\n    }\n    const delta = downloadedBytes - lastDownloadedBytes;\n    lastDownloadedBytes = downloadedBytes;\n    progressBar.tick(delta);\n  };\n}\nfunction toMegabytes(bytes) {\n  const mb = bytes / 1000 / 1000;\n  return `${Math.round(mb * 10) / 10} MB`;\n}","map":{"version":3,"names":["assert","spawnSync","existsSync","readFileSync","mkdir","unlink","os","path","ProgressBarClass","Browser","BrowserPlatform","downloadUrls","Cache","InstalledBrowser","debug","detectBrowserPlatform","unpackArchive","downloadFile","getJSON","headHttpRequest","debugInstall","times","Map","debugTime","label","set","process","hrtime","debugTimeEnd","end","start","get","duration","install","options","platform","unpack","Error","arch","url","getDownloadUrl","browser","buildId","baseUrl","installUrl","err","forceFallbackForTesting","CHROME","CHROMEDRIVER","CHROMEHEADLESSSHELL","version","URL","LINUX","MAC_ARM","MAC","WIN32","WIN64","backupUrl","downloads","find","link","toString","installDeps","installedBrowser","depsPath","join","dirname","executablePath","data","split","getuid","result","status","error","stdout","stderr","downloadProgressCallback","makeProgressCallback","buildIdAlias","fileName","decodeURIComponent","pop","cache","cacheDir","browserRoot","archivePath","recursive","outputPath","installationDir","runSetup","metadata","readMetadata","aliases","writeMetadata","browserDir","setupExePath","shell","uninstall","getInstalledBrowsers","canDownload","progressBar","lastDownloadedBytes","downloadedBytes","totalBytes","toMegabytes","complete","incomplete","width","total","delta","tick","bytes","mb","Math","round"],"sources":["/Users/goyac1/Desktop/Projects/puppeteer/node_modules/@puppeteer/browsers/src/install.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2017 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport assert from 'node:assert';\nimport {spawnSync} from 'node:child_process';\nimport {existsSync, readFileSync} from 'node:fs';\nimport {mkdir, unlink} from 'node:fs/promises';\nimport os from 'node:os';\nimport path from 'node:path';\n\nimport type * as ProgressBar from 'progress';\nimport ProgressBarClass from 'progress';\n\nimport {\n  Browser,\n  BrowserPlatform,\n  downloadUrls,\n} from './browser-data/browser-data.js';\nimport {Cache, InstalledBrowser} from './Cache.js';\nimport {debug} from './debug.js';\nimport {detectBrowserPlatform} from './detectPlatform.js';\nimport {unpackArchive} from './fileUtil.js';\nimport {downloadFile, getJSON, headHttpRequest} from './httpUtil.js';\n\nconst debugInstall = debug('puppeteer:browsers:install');\n\nconst times = new Map<string, [number, number]>();\nfunction debugTime(label: string) {\n  times.set(label, process.hrtime());\n}\n\nfunction debugTimeEnd(label: string) {\n  const end = process.hrtime();\n  const start = times.get(label);\n  if (!start) {\n    return;\n  }\n  const duration =\n    end[0] * 1000 + end[1] / 1e6 - (start[0] * 1000 + start[1] / 1e6); // calculate duration in milliseconds\n  debugInstall(`Duration for ${label}: ${duration}ms`);\n}\n\n/**\n * @public\n */\nexport interface InstallOptions {\n  /**\n   * Determines the path to download browsers to.\n   */\n  cacheDir: string;\n  /**\n   * Determines which platform the browser will be suited for.\n   *\n   * @defaultValue **Auto-detected.**\n   */\n  platform?: BrowserPlatform;\n  /**\n   * Determines which browser to install.\n   */\n  browser: Browser;\n  /**\n   * Determines which buildId to download. BuildId should uniquely identify\n   * binaries and they are used for caching.\n   */\n  buildId: string;\n  /**\n   * An alias for the provided `buildId`. It will be used to maintain local\n   * metadata to support aliases in the `launch` command.\n   *\n   * @example 'canary'\n   */\n  buildIdAlias?: string;\n  /**\n   * Provides information about the progress of the download. If set to\n   * 'default', the default callback implementing a progress bar will be\n   * used.\n   */\n  downloadProgressCallback?:\n    | 'default'\n    | ((downloadedBytes: number, totalBytes: number) => void);\n  /**\n   * Determines the host that will be used for downloading.\n   *\n   * @defaultValue Either\n   *\n   * - https://storage.googleapis.com/chrome-for-testing-public or\n   * - https://archive.mozilla.org/pub/firefox/nightly/latest-mozilla-central\n   *\n   */\n  baseUrl?: string;\n  /**\n   * Whether to unpack and install browser archives.\n   *\n   * @defaultValue `true`\n   */\n  unpack?: boolean;\n  /**\n   * @internal\n   * @defaultValue `false`\n   */\n  forceFallbackForTesting?: boolean;\n\n  /**\n   * Whether to attempt to install system-level dependencies required\n   * for the browser.\n   *\n   * Only supported for Chrome on Debian or Ubuntu.\n   * Requires system-level privileges to run `apt-get`.\n   *\n   * @defaultValue `false`\n   */\n  installDeps?: boolean;\n}\n\n/**\n * Downloads and unpacks the browser archive according to the\n * {@link InstallOptions}.\n *\n * @returns a {@link InstalledBrowser} instance.\n *\n * @public\n */\nexport function install(\n  options: InstallOptions & {unpack?: true},\n): Promise<InstalledBrowser>;\n/**\n * Downloads the browser archive according to the {@link InstallOptions} without\n * unpacking.\n *\n * @returns the absolute path to the archive.\n *\n * @public\n */\nexport function install(\n  options: InstallOptions & {unpack: false},\n): Promise<string>;\nexport async function install(\n  options: InstallOptions,\n): Promise<InstalledBrowser | string> {\n  options.platform ??= detectBrowserPlatform();\n  options.unpack ??= true;\n  if (!options.platform) {\n    throw new Error(\n      `Cannot download a binary for the provided platform: ${os.platform()} (${os.arch()})`,\n    );\n  }\n  const url = getDownloadUrl(\n    options.browser,\n    options.platform,\n    options.buildId,\n    options.baseUrl,\n  );\n  try {\n    return await installUrl(url, options);\n  } catch (err) {\n    // If custom baseUrl is provided, do not fall back to CfT dashboard.\n    if (options.baseUrl && !options.forceFallbackForTesting) {\n      throw err;\n    }\n    debugInstall(`Error downloading from ${url}.`);\n    switch (options.browser) {\n      case Browser.CHROME:\n      case Browser.CHROMEDRIVER:\n      case Browser.CHROMEHEADLESSSHELL: {\n        debugInstall(\n          `Trying to find download URL via https://googlechromelabs.github.io/chrome-for-testing.`,\n        );\n        interface Version {\n          downloads: Record<string, Array<{platform: string; url: string}>>;\n        }\n        const version = (await getJSON(\n          new URL(\n            `https://googlechromelabs.github.io/chrome-for-testing/${options.buildId}.json`,\n          ),\n        )) as Version;\n        let platform = '';\n        switch (options.platform) {\n          case BrowserPlatform.LINUX:\n            platform = 'linux64';\n            break;\n          case BrowserPlatform.MAC_ARM:\n            platform = 'mac-arm64';\n            break;\n          case BrowserPlatform.MAC:\n            platform = 'mac-x64';\n            break;\n          case BrowserPlatform.WIN32:\n            platform = 'win32';\n            break;\n          case BrowserPlatform.WIN64:\n            platform = 'win64';\n            break;\n        }\n        const backupUrl = version.downloads[options.browser]?.find(link => {\n          return link['platform'] === platform;\n        })?.url;\n        if (backupUrl) {\n          // If the URL is the same, skip the retry.\n          if (backupUrl === url.toString()) {\n            throw err;\n          }\n          debugInstall(`Falling back to downloading from ${backupUrl}.`);\n          return await installUrl(new URL(backupUrl), options);\n        }\n        throw err;\n      }\n      default:\n        throw err;\n    }\n  }\n}\n\nasync function installDeps(installedBrowser: InstalledBrowser) {\n  if (\n    process.platform !== 'linux' ||\n    installedBrowser.platform !== BrowserPlatform.LINUX\n  ) {\n    return;\n  }\n  // Currently, only Debian-like deps are supported.\n  const depsPath = path.join(\n    path.dirname(installedBrowser.executablePath),\n    'deb.deps',\n  );\n  if (!existsSync(depsPath)) {\n    debugInstall(`deb.deps file was not found at ${depsPath}`);\n    return;\n  }\n  const data = readFileSync(depsPath, 'utf-8').split('\\n').join(',');\n  if (process.getuid?.() !== 0) {\n    throw new Error('Installing system dependencies requires root privileges');\n  }\n  let result = spawnSync('apt-get', ['-v']);\n  if (result.status !== 0) {\n    throw new Error(\n      'Failed to install system dependencies: apt-get does not seem to be available',\n    );\n  }\n  debugInstall(`Trying to install dependencies: ${data}`);\n  result = spawnSync('apt-get', [\n    'satisfy',\n    '-y',\n    data,\n    '--no-install-recommends',\n  ]);\n  if (result.status !== 0) {\n    throw new Error(\n      `Failed to install system dependencies: status=${result.status},error=${result.error},stdout=${result.stdout.toString('utf8')},stderr=${result.stderr.toString('utf8')}`,\n    );\n  }\n  debugInstall(`Installed system dependencies ${data}`);\n}\n\nasync function installUrl(\n  url: URL,\n  options: InstallOptions,\n): Promise<InstalledBrowser | string> {\n  options.platform ??= detectBrowserPlatform();\n  if (!options.platform) {\n    throw new Error(\n      `Cannot download a binary for the provided platform: ${os.platform()} (${os.arch()})`,\n    );\n  }\n  let downloadProgressCallback = options.downloadProgressCallback;\n  if (downloadProgressCallback === 'default') {\n    downloadProgressCallback = await makeProgressCallback(\n      options.browser,\n      options.buildIdAlias ?? options.buildId,\n    );\n  }\n  const fileName = decodeURIComponent(url.toString()).split('/').pop();\n  assert(fileName, `A malformed download URL was found: ${url}.`);\n  const cache = new Cache(options.cacheDir);\n  const browserRoot = cache.browserRoot(options.browser);\n  const archivePath = path.join(browserRoot, `${options.buildId}-${fileName}`);\n  if (!existsSync(browserRoot)) {\n    await mkdir(browserRoot, {recursive: true});\n  }\n\n  if (!options.unpack) {\n    if (existsSync(archivePath)) {\n      return archivePath;\n    }\n    debugInstall(`Downloading binary from ${url}`);\n    debugTime('download');\n    await downloadFile(url, archivePath, downloadProgressCallback);\n    debugTimeEnd('download');\n    return archivePath;\n  }\n\n  const outputPath = cache.installationDir(\n    options.browser,\n    options.platform,\n    options.buildId,\n  );\n\n  try {\n    if (existsSync(outputPath)) {\n      const installedBrowser = new InstalledBrowser(\n        cache,\n        options.browser,\n        options.buildId,\n        options.platform,\n      );\n      if (!existsSync(installedBrowser.executablePath)) {\n        throw new Error(\n          `The browser folder (${outputPath}) exists but the executable (${installedBrowser.executablePath}) is missing`,\n        );\n      }\n      await runSetup(installedBrowser);\n      if (options.installDeps) {\n        await installDeps(installedBrowser);\n      }\n      return installedBrowser;\n    }\n    debugInstall(`Downloading binary from ${url}`);\n    try {\n      debugTime('download');\n      await downloadFile(url, archivePath, downloadProgressCallback);\n    } finally {\n      debugTimeEnd('download');\n    }\n\n    debugInstall(`Installing ${archivePath} to ${outputPath}`);\n    try {\n      debugTime('extract');\n      await unpackArchive(archivePath, outputPath);\n    } finally {\n      debugTimeEnd('extract');\n    }\n\n    const installedBrowser = new InstalledBrowser(\n      cache,\n      options.browser,\n      options.buildId,\n      options.platform,\n    );\n    if (options.buildIdAlias) {\n      const metadata = installedBrowser.readMetadata();\n      metadata.aliases[options.buildIdAlias] = options.buildId;\n      installedBrowser.writeMetadata(metadata);\n    }\n\n    await runSetup(installedBrowser);\n    if (options.installDeps) {\n      await installDeps(installedBrowser);\n    }\n    return installedBrowser;\n  } finally {\n    if (existsSync(archivePath)) {\n      await unlink(archivePath);\n    }\n  }\n}\n\nasync function runSetup(installedBrowser: InstalledBrowser): Promise<void> {\n  // On Windows for Chrome invoke setup.exe to configure sandboxes.\n  if (\n    (installedBrowser.platform === BrowserPlatform.WIN32 ||\n      installedBrowser.platform === BrowserPlatform.WIN64) &&\n    installedBrowser.browser === Browser.CHROME &&\n    installedBrowser.platform === detectBrowserPlatform()\n  ) {\n    try {\n      debugTime('permissions');\n      const browserDir = path.dirname(installedBrowser.executablePath);\n      const setupExePath = path.join(browserDir, 'setup.exe');\n      if (!existsSync(setupExePath)) {\n        return;\n      }\n      spawnSync(\n        path.join(browserDir, 'setup.exe'),\n        [`--configure-browser-in-directory=` + browserDir],\n        {\n          shell: true,\n        },\n      );\n      // TODO: Handle error here. Currently the setup.exe sometimes\n      // errors although it sets the permissions correctly.\n    } finally {\n      debugTimeEnd('permissions');\n    }\n  }\n}\n\n/**\n * @public\n */\nexport interface UninstallOptions {\n  /**\n   * Determines the platform for the browser binary.\n   *\n   * @defaultValue **Auto-detected.**\n   */\n  platform?: BrowserPlatform;\n  /**\n   * The path to the root of the cache directory.\n   */\n  cacheDir: string;\n  /**\n   * Determines which browser to uninstall.\n   */\n  browser: Browser;\n  /**\n   * The browser build to uninstall\n   */\n  buildId: string;\n}\n\n/**\n *\n * @public\n */\nexport async function uninstall(options: UninstallOptions): Promise<void> {\n  options.platform ??= detectBrowserPlatform();\n  if (!options.platform) {\n    throw new Error(\n      `Cannot detect the browser platform for: ${os.platform()} (${os.arch()})`,\n    );\n  }\n\n  new Cache(options.cacheDir).uninstall(\n    options.browser,\n    options.platform,\n    options.buildId,\n  );\n}\n\n/**\n * @public\n */\nexport interface GetInstalledBrowsersOptions {\n  /**\n   * The path to the root of the cache directory.\n   */\n  cacheDir: string;\n}\n\n/**\n * Returns metadata about browsers installed in the cache directory.\n *\n * @public\n */\nexport async function getInstalledBrowsers(\n  options: GetInstalledBrowsersOptions,\n): Promise<InstalledBrowser[]> {\n  return new Cache(options.cacheDir).getInstalledBrowsers();\n}\n\n/**\n * @public\n */\nexport async function canDownload(options: InstallOptions): Promise<boolean> {\n  options.platform ??= detectBrowserPlatform();\n  if (!options.platform) {\n    throw new Error(\n      `Cannot download a binary for the provided platform: ${os.platform()} (${os.arch()})`,\n    );\n  }\n  return await headHttpRequest(\n    getDownloadUrl(\n      options.browser,\n      options.platform,\n      options.buildId,\n      options.baseUrl,\n    ),\n  );\n}\n\n/**\n * Retrieves a URL for downloading the binary archive of a given browser.\n *\n * The archive is bound to the specific platform and build ID specified.\n *\n * @public\n */\nexport function getDownloadUrl(\n  browser: Browser,\n  platform: BrowserPlatform,\n  buildId: string,\n  baseUrl?: string,\n): URL {\n  return new URL(downloadUrls[browser](platform, buildId, baseUrl));\n}\n\n/**\n * @public\n */\nexport function makeProgressCallback(\n  browser: Browser,\n  buildId: string,\n): (downloadedBytes: number, totalBytes: number) => void {\n  let progressBar: ProgressBar;\n\n  let lastDownloadedBytes = 0;\n  return (downloadedBytes: number, totalBytes: number) => {\n    if (!progressBar) {\n      progressBar = new ProgressBarClass(\n        `Downloading ${browser} ${buildId} - ${toMegabytes(\n          totalBytes,\n        )} [:bar] :percent :etas `,\n        {\n          complete: '=',\n          incomplete: ' ',\n          width: 20,\n          total: totalBytes,\n        },\n      );\n    }\n    const delta = downloadedBytes - lastDownloadedBytes;\n    lastDownloadedBytes = downloadedBytes;\n    progressBar.tick(delta);\n  };\n}\n\nfunction toMegabytes(bytes: number) {\n  const mb = bytes / 1000 / 1000;\n  return `${Math.round(mb * 10) / 10} MB`;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}